<!DOCTYPE html>
<html ng-app="vihuelaApp">
  <head>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap.min.css">
    <!--
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap-theme.min.css">
    -->
    <link href="css/app.css" rel="stylesheet" type="text/css">
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.2.27/angular.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/angular-ui-bootstrap/0.12.0/ui-bootstrap.min.js"></script>
    <script src="js/app.js"></script>
    <script src="js/controllers.js"></script>
    <script src="js/filters.js"></script>
    <script type="text/javascript">
      function init() {
        resize();
        document.getElementById('searchInput').onkeypress = function(e) {
          if (!e) e = window.event;
          var keyCode = e.keyCode || e.which;
          if (keyCode == '13') { 
            //<Enter> has been pressed
            angular.element(document.getElementById('searchInput')).scope().doSearch();
            return false;
          }
        }
      }
      function resize() {
        var container = document.getElementById('container');
        var header = document.getElementById('header');
        var footer = document.getElementById('footer');
        var contentHeight = container.clientHeight - header.clientHeight - footer.clientHeight - 2;
        document.getElementById('navPanel').style.height=contentHeight+'px';
        document.getElementById('infoPanel').style.height=contentHeight+'px';
      }
    </script>
  </head>
  <body ng-controller="vihuelaCtrl" onload="init()" onresize="resize()" ng-init="searchAll=true"> 
    <div id="container" class="container-fluid">
      <div id="header" class="row">
        <div class="col-xs-4" em-height-source>  
          <div class="form-group">
              <label for="bookSelect">Book:</label>
              <div id="bookSelect" class="input-group">
                <input class="form-control bookTitle" type="text" value="{{getBookTitle(currentBook)}}" disabled>
                <span class="input-group-btn">
                  <div class="btn-group " dropdown is-open="status.isopen">
                    <button type="button" class="btn btn-default dropdown-toggle" dropdown-toggle ng-disabled="disabled">
                      <span class="caret"></span>
                    </button>
                    <ul class="dropdown-menu dropdown-menu-right" role="menu">
                      <li ng-repeat="book in books"><a href="#" ng-click="selectBook(book)">{{getBookTitle(book)}}</a></li>
                    </ul>
                  </div>
                </span>
             </div>
          </div>   
        </div>
        <div class="col-xs-8">
        <div class="radio">
          <label><input type="radio" ng-model="searchAll" ng-value="true">Search all books</label>
          <label><input type="radio" ng-model="searchAll" ng-value="false">Search current book</label>
        </div>
          <div class="form-group">
            <div id="search" class="input-group">
              <input id="searchInput" class="form-control" type="text">
                <span class="input-group-btn" >
                  <button id="searchButton" class="btn btn-default" type="button" ng-click="doSearch()">Search</button>  
                </span>
             </div>
          </div>
        </div>
      </div>
      <div id="content" class="row">
        <div class="col-xs-4">
          <div id="navPanel">
            <ul class="nav nav-pills nav-stacked">
              <li ng-repeat="record in records | recordsFilter:currentChapter:currentType">
                <a href="#" ng-click="selectRecord(record)">{{ getTitle(record, showBookId) }}&nbsp;</a>
              </li>
            </ul>
          </div>
        </div>
        <div class="col-xs-8">
          <div id="infoPanel">
            <div id="infoContent" style="display:none;">
              <button id="pdfButton" class="btn btn-md btn-primary pagesButton" type="button" ng-click="downloadAsPdf()">Download PDF</button>
              <button id="zipButton" class="btn btn-md btn-primary pagesButton" type="button" ng-click="downloadAsZip()">Download images</button>
              <h3>Author:</h3>
              <p>{{(currentRecord.authorId==-1)?'-':getAuthorName(currentRecord.authorId)}}</p>
              <h3>Title:</h3>
              <p>{{getTitle(currentRecord, 0)}}</p>
              <h3>Type:</h3>
              <p>{{(currentRecord.typeId==0)?'-':getTypeName(currentRecord.typeId)}}</p>
              <h3>Notes:</h3>
              <p>{{(currentRecord.notes=='')?'-':(currentRecord.notes)}}</p>
            </div>
          </div>    
        </div>
      </div>
      <div id="footer" class="row">
        <div class="col-xs-4">
          <div class="footerPanel">
            <div class="form-group"> 
              <label for="chapterSelect">Chapter:</label> 
              <select id="chapterSelect" class="form-control" ng-model="currentChapter" ng-options="(chapter.title) for chapter in chapters"></select>
            </div>
            <div class="form-group">
              <label for="typeSelect">Type:</label>
              <select id="typeSelect" class="form-control" ng-model="currentType" ng-options="(type.title) for type in types"></select>
            </div>
          </div>          
        </div>
        <div class="col-xs-8">
          <div class="footerPanel">
            <div id="previewContent">
              <div id="previewCell">
                <a ng-repeat="page in pages" ng-href="images/pages/{{page.filename}}" target="_blank">
                  <img ng-src="images/preview/{{page.filename}}"/>
                </a>
              </div>
            </div>
          </div>  
        </div>
      </div>
    </div>
  </body>
</html>